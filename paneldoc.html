<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Panel Doctor - SomaFix</title>
    <link rel="stylesheet" href="mitodo.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .modal-bg {
            position: fixed;
            inset: 0;
            background: rgba(40,60,90,0.25);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-bg.active {
            display: flex;
        }
        .modal {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px #5b7fff33;
            padding: 32px 24px 24px 24px;
            max-width: 90vw;
            min-width: 340px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalIn 0.5s cubic-bezier(.68,-0.55,.27,1.55);
        }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.8);}
            to   { opacity: 1; transform: scale(1);}
        }
        .modal-close {
            position: absolute;
            top: 16px; right: 18px;
            font-size: 1.7rem;
            color: #5b7fff;
            cursor: pointer;
            font-weight: bold;
            transition: color 0.2s;
        }
        .modal-close:hover {
            color: #ff4d4d;
        }
        .tabla-dinamica {
            border-collapse: collapse;
            margin: 0 auto 24px auto;
            background: #f8fafc;
            font-size: 1rem;
        }
        .tabla-dinamica th, .tabla-dinamica td {
            border: 1px solid #b5c7e7;
            padding: 7px 10px;
            text-align: center;
        }
        .tabla-dinamica th {
            background: #e0e7ef;
            font-weight: 600;
        }
        .tabla-dinamica tr:hover td {
            background: #f0f4fa;
        }
        .grafico-container {
            max-width: 600px;
            margin: 30px auto 40px auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 12px #b5c7e733;
            padding: 24px 12px 12px 12px;
        }
        .apartado-comparativa {
            margin-top: 60px;
            padding: 24px 12px;
            background: #f5f7fa;
            border-radius: 18px;
            box-shadow: 0 2px 12px #b5c7e722;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
        }
        .info-paciente {
            margin-bottom:18px; 
            text-align:left; 
            background:#f5f7fa; 
            border-radius:10px; 
            padding:12px 18px;
        }
        .info-extra {
            margin-bottom:18px; 
            text-align:left; 
            background:#e9f6ff; 
            border-radius:10px; 
            padding:12px 18px;
            font-size: 0.98em;
        }
        .btn-ver {
            margin: 8px 4px 8px 0;
            padding: 8px 18px;
            border-radius: 7px;
            border: none;
            background: linear-gradient(90deg, #5b7fff 0%, #4fd1c5 100%);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }
        .btn-ver:hover {
            background: linear-gradient(90deg, #4fd1c5 0%, #5b7fff 100%);
            transform: translateY(-2px) scale(1.03);
        }
        @media (max-width: 600px) {
            .modal { min-width: 0; padding: 12px 2vw 12px 2vw;}
            .grafico-container, .apartado-comparativa { padding: 10px 2vw;}
            .container { padding: 0 2vw; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Panel del Doctor</h1>
        <hr>
        <h2>Ver resultados de los pacientes</h2>
        <div id="botonesPacientes" style="margin-bottom:24px;">
            <button class="btn-ver" onclick="mostrarDatosPaciente('P001')">Ver P001</button>
            <button class="btn-ver" onclick="mostrarDatosPaciente('P002')">Ver P002</button>
            <button class="btn-ver" onclick="mostrarDatosPaciente('P003')">Ver P003</button>
            <button class="btn-ver" onclick="mostrarDatosPaciente('P004')">Ver P004</button>
            <button class="btn-ver" onclick="mostrarDatosPaciente('P005')">Ver P005</button>
            <button class="btn-ver" onclick="mostrarDatosPaciente('P006')">Ver P006</button>
            <button class="btn-ver" onclick="mostrarDatosPaciente('P007')">Ver P007</button>
        </div>
        <button class="btn" onclick="window.history.back()" style="margin-top:10px;">Volver</button>
        <div class="apartado-comparativa">
            <h2 style="text-align:center;">Comparativa de mejora entre pacientes</h2>
            <canvas id="graficoComparativa" style="max-width:100%;"></canvas>
        </div>
    </div>
    <!-- Modal para resultados de paciente -->
    <div class="modal-bg" id="modalPaciente">
        <div class="modal">
            <span class="modal-close" onclick="cerrarModal()">&times;</span>
            <h2 id="modalTitulo"></h2>
            <div id="tablaModal"></div>
            <div class="grafico-container">
                <canvas id="graficoDolor" style="max-width:100%;"></canvas>
            </div>
        </div>
    </div>
    <script>
    // Datos fijos para cada paciente (tabla y gráfico)
    const pacientesDatos = {
        P001: {
            info: {
                nombre: "P001",
                edad: 59,
                diagnostico: "Cervicalgia crónica",
                grupo: "Ondas",
                descripcion: "Hombre de 59 años con cervicalgia crónica.",
                observaciones: "No presenta observaciones adicionales.",
                recomendacion: "40 Hz + 432 Hz durante 30 minutos, preferiblemente por la mañana.",
                objetivo: "Aliviar el dolor nervioso y reducir el estrés."
            },
            tabla: [
                ["Dolor mínimo", 5, 5, 4, 4, 4, 3, 3],
                ["Dolor máximo", 8, 7, 7, 6, 6, 5, 5],
                ["Emoción", "Mal", "Regular", "Regular", "Bien", "Bien", "Bien", "Bien"],
                ["Afecta actividades", "Sí", "Sí", "No", "No", "No", "No", "No"],
                ["Sueño", "Mal", "Mal", "Bien", "Bien", "Bien", "Bien", "Bien"],
                ["Música hoy", "No", "Sí", "Sí", "Sí", "Sí", "Sí", "Sí"],
                ["Movilidad", "Baja", "Media", "Media", "Alta", "Alta", "Alta", "Alta"],
                ["Peor momento", "Mañana", "Tarde", "Tarde", "Noche", "Noche", "Noche", "Noche"],
                ["Tiempo dolor", "3h", "2h", "2h", "1h", "1h", "1h", "1h"]
            ],
            dias: ["01", "05", "10", "15", "20", "25", "31"],
            dolorMin: [5, 5, 4, 4, 4, 3, 3],
            dolorMax: [8, 7, 7, 6, 6, 5, 5]
        },
        P002: {
            info: {
                nombre: "P002",
                edad: 56,
                diagnostico: "Dolor neuropático",
                grupo: "Ondas",
                descripcion: "Hombre de 56 años con dolor neuropático.",
                observaciones: "Presenta depresión y en alguna ocasión ha necesitado tomar opioides.",
                recomendacion: "40 Hz + 9 Hz durante 40 minutos, por la mañana o por la tarde.",
                objetivo: "Liberación emocional, mejora del estado de ánimo y alivio del dolor."
            },
            tabla: [
                ["Dolor mínimo", 6, 6, 5, 5, 5, 4, 4],
                ["Dolor máximo", 8, 8, 7, 7, 7, 6, 6],
                ["Emoción", "Mal", "Regular", "Regular", "Bien", "Bien", "Bien", "Bien"],
                ["Afecta actividades", "Sí", "Sí", "Sí", "No", "No", "No", "No"],
                ["Sueño", "Mal", "Mal", "Bien", "Bien", "Bien", "Bien", "Bien"],
                ["Música hoy", "No", "Sí", "Sí", "Sí", "Sí", "Sí", "Sí"],
                ["Movilidad", "Baja", "Media", "Media", "Alta", "Alta", "Alta", "Alta"],
                ["Peor momento", "Mañana", "Tarde", "Tarde", "Noche", "Noche", "Noche", "Noche"],
                ["Tiempo dolor", "4h", "3h", "3h", "2h", "2h", "2h", "2h"]
            ],
            dias: ["01", "05", "10", "15", "20", "25", "31"],
            dolorMin: [6, 6, 5, 5, 5, 4, 4],
            dolorMax: [8, 8, 7, 7, 7, 6, 6]
        },
        P003: {
            info: {
                nombre: "P003",
                edad: 38,
                diagnostico: "Ciática",
                grupo: "Ondas",
                descripcion: "Mujer de 38 años con ciática.",
                observaciones: "No presenta observaciones adicionales.",
                recomendacion: "40 Hz + 174 Hz durante 30 minutos, preferentemente por la tarde.",
                objetivo: "Alivio del dolor neuropático y relajación muscular."
            },
            tabla: [
                ["Dolor mínimo", 4, 4, 3, 3, 3, 2, 2],
                ["Dolor máximo", 7, 7, 6, 6, 6, 5, 5],
                ["Emoción", "Regular", "Regular", "Bien", "Bien", "Bien", "Bien", "Bien"],
                ["Afecta actividades", "Sí", "No", "No", "No", "No", "No", "No"],
                ["Sueño", "Mal", "Bien", "Bien", "Bien", "Bien", "Bien", "Bien"],
                ["Música hoy", "No", "Sí", "Sí", "Sí", "Sí", "Sí", "Sí"],
                ["Movilidad", "Media", "Media", "Alta", "Alta", "Alta", "Alta", "Alta"],
                ["Peor momento", "Tarde", "Tarde", "Noche", "Noche", "Noche", "Noche", "Noche"],
                ["Tiempo dolor", "2h", "2h", "1h", "1h", "1h", "1h", "1h"]
            ],
            dias: ["01", "05", "10", "15", "20", "25", "31"],
            dolorMin: [4, 4, 3, 3, 3, 2, 2],
            dolorMax: [7, 7, 6, 6, 6, 5, 5]
        },
        P004: {
            info: {
                nombre: "P004",
                edad: 61,
                diagnostico: "Lumbalgia crónica",
                grupo: "Ondas",
                descripcion: "Hombre de 61 años con lumbalgia crónica.",
                observaciones: "No hay observaciones adicionales.",
                recomendacion: "432 Hz + 852 Hz durante 30 minutos, por la tarde o la noche.",
                objetivo: "Alivio del dolor lumbar y reducción de la ansiedad."
            },
            tabla: [
                ["Dolor mínimo", 7, 7, 7, 7, 7, 7, 7],
                ["Dolor máximo", 9, 9, 9, 9, 9, 9, 9],
                ["Emoción", "Mal", "Mal", "Mal", "Mal", "Mal", "Mal", "Mal"],
                ["Afecta actividades", "Sí", "Sí", "Sí", "Sí", "Sí", "Sí", "Sí"],
                ["Sueño", "Mal", "Mal", "Mal", "Mal", "Mal", "Mal", "Mal"],
                ["Música hoy", "No", "No", "No", "No", "No", "No", "No"],
                ["Movilidad", "Baja", "Baja", "Baja", "Baja", "Baja", "Baja", "Baja"],
                ["Peor momento", "Noche", "Noche", "Noche", "Noche", "Noche", "Noche", "Noche"],
                ["Tiempo dolor", "5h", "5h", "5h", "5h", "5h", "5h", "5h"]
            ],
            dias: ["01", "05", "10", "15", "20", "25", "31"],
            dolorMin: [7, 7, 7, 7, 7, 7, 7],
            dolorMax: [9, 9, 9, 9, 9, 9, 9]
        },
        P005: {
            info: {
                nombre: "P005",
                edad: 42,
                diagnostico: "Lumbalgia crónica",
                grupo: "Música",
                descripcion: "Mujer de 42 años con lumbalgia crónica.",
                observaciones: "No hay observaciones adicionales.",
                recomendacion: "432 Hz + 852 Hz durante 30 minutos, por la tarde o la noche.",
                objetivo: "Alivio del dolor lumbar y reducción de la ansiedad."
            },
            tabla: [
                ["Dolor mínimo", 5, 5, 4, 4, 3, 3, 2],
                ["Dolor máximo", 7, 7, 6, 6, 5, 5, 4],
                ["Emoción", "Regular", "Regular", "Bien", "Bien", "Bien", "Bien", "Bien"],
                ["Afecta actividades", "Sí", "No", "No", "No", "No", "No", "No"],
                ["Sueño", "Mal", "Bien", "Bien", "Bien", "Bien", "Bien", "Bien"],
                ["Música hoy", "No", "Sí", "Sí", "Sí", "Sí", "Sí", "Sí"],
                ["Movilidad", "Media", "Alta", "Alta", "Alta", "Alta", "Alta", "Alta"],
                ["Peor momento", "Tarde", "Noche", "Noche", "Noche", "Noche", "Noche", "Noche"],
                ["Tiempo dolor", "3h", "2h", "2h", "1h", "1h", "1h", "1h"]
            ],
            dias: ["01", "05", "10", "15", "20", "25", "31"],
            dolorMin: [5, 5, 4, 4, 3, 3, 2],
            dolorMax: [7, 7, 6, 6, 5, 5, 4]
        },
        P006: {
            info: {
                nombre: "P006",
                edad: 50,
                diagnostico: "Fibromialgia y depresión",
                grupo: "Música",
                descripcion: "Mujer de 50 años con fibromialgia y depresión.",
                observaciones: "",
                recomendacion: "40 Hz + 528 Hz durante 40 minutos, por la mañana.",
                objetivo: "Reducir el dolor generalizado, favorecer la liberación emocional y aumentar la vitalidad."
            },
            tabla: [
                ["Dolor mínimo", 6, 6, 5, 5, 4, 4, 3],
                ["Dolor máximo", 8, 8, 7, 7, 6, 6, 5],
                ["Emoción", "Mal", "Regular", "Regular", "Bien", "Bien", "Bien", "Bien"],
                ["Afecta actividades", "Sí", "Sí", "No", "No", "No", "No", "No"],
                ["Sueño", "Mal", "Mal", "Bien", "Bien", "Bien", "Bien", "Bien"],
                ["Música hoy", "No", "Sí", "Sí", "Sí", "Sí", "Sí", "Sí"],
                ["Movilidad", "Baja", "Media", "Media", "Alta", "Alta", "Alta", "Alta"],
                ["Peor momento", "Mañana", "Tarde", "Tarde", "Noche", "Noche", "Noche", "Noche"],
                ["Tiempo dolor", "4h", "3h", "3h", "2h", "2h", "2h", "2h"]
            ],
            dias: ["01", "05", "10", "15", "20", "25", "31"],
            dolorMin: [6, 6, 5, 5, 4, 4, 3],
            dolorMax: [8, 8, 7, 7, 6, 6, 5]
        },
        P007: {
            info: {
                nombre: "P007",
                edad: 45,
                diagnostico: "Migraña crónica y depresión",
                grupo: "Música",
                descripcion: "Hombre de 45 años con migraña crónica y depresión.",
                observaciones: "",
                recomendacion: "40 Hz + 432 Hz durante 30 minutos, por la mañana.",
                objetivo: "Reducir la intensidad de la migraña y mejorar el estado de ánimo."
            },
            tabla: [
                ["Dolor mínimo", 5, 5, 4, 4, 3, 3, 2],
                ["Dolor máximo", 6, 6, 5, 5, 4, 4, 3],
                ["Emoción", "Regular", "Regular", "Bien", "Bien", "Bien", "Bien", "Bien"],
                ["Afecta actividades", "Sí", "No", "No", "No", "No", "No", "No"],
                ["Sueño", "Mal", "Bien", "Bien", "Bien", "Bien", "Bien", "Bien"],
                ["Música hoy", "No", "Sí", "Sí", "Sí", "Sí", "Sí", "Sí"],
                ["Movilidad", "Media", "Alta", "Alta", "Alta", "Alta", "Alta", "Alta"],
                ["Peor momento", "Tarde", "Noche", "Noche", "Noche", "Noche", "Noche", "Noche"],
                ["Tiempo dolor", "3h", "2h", "2h", "1h", "1h", "1h", "1h"]
            ],
            dias: ["01", "05", "10", "15", "20", "25", "31"],
            dolorMin: [5, 5, 4, 4, 3, 3, 2],
            dolorMax: [6, 6, 5, 5, 4, 4, 3]
        }
    };

    function cerrarModal() {
        document.getElementById('modalPaciente').classList.remove('active');
        if (window.graficoDolorObj) window.graficoDolorObj.destroy();
    }

    function mostrarDatosPaciente(nombre) {
        const paciente = pacientesDatos[nombre];
        if (!paciente) {
            document.getElementById('tablaModal').innerHTML = "<p>No hay registros para este paciente.</p>";
            document.getElementById('modalTitulo').textContent = "";
            document.getElementById('modalPaciente').classList.add('active');
            return;
        }
        // Info paciente
        let info = paciente.info;
        let infoHtml = `
            <div class="info-paciente">
                <b>Nombre:</b> ${info.nombre}<br>
                <b>Edad:</b> ${info.edad} años<br>
                <b>Diagnóstico:</b> ${info.diagnostico}<br>
                <b>Grupo:</b> ${info.grupo}
            </div>
            <div class="info-extra">
                <b>Descripción:</b> ${info.descripcion || ""}<br>
                <b>Observaciones:</b> ${info.observaciones || ""}<br>
                <b>Recomendación:</b> ${info.recomendacion || ""}<br>
                <b>Objetivo:</b> ${info.objetivo || ""}
            </div>
        `;
        // Tabla
        let tabla = `<table class="tabla-dinamica"><thead><tr><th>Pregunta / Día</th>`;
        paciente.dias.forEach(dia => {
            tabla += `<th>${dia}</th>`;
        });
        tabla += `</tr></thead><tbody>`;
        paciente.tabla.forEach(row => {
            tabla += `<tr><th>${row[0]}</th>`;
            for (let i = 1; i < row.length; i++) {
                tabla += `<td>${row[i]}</td>`;
            }
            tabla += `</tr>`;
        });
        tabla += `</tbody></table>`;
        document.getElementById('tablaModal').innerHTML = infoHtml + tabla;
        document.getElementById('modalTitulo').textContent = `Resultados de ${nombre} (Julio 2025)`;
        document.getElementById('modalPaciente').classList.add('active');

        // Gráfico de dolor
        let ctx = document.getElementById('graficoDolor').getContext('2d');
        if (window.graficoDolorObj) window.graficoDolorObj.destroy();
        window.graficoDolorObj = new Chart(ctx, {
            type: 'line',
            data: {
                labels: paciente.dias,
                datasets: [
                    { label: 'Dolor mínimo', data: paciente.dolorMin, borderColor: '#4fd1c5', backgroundColor: '#4fd1c588', fill: false, tension: 0.2 },
                    { label: 'Dolor máximo', data: paciente.dolorMax, borderColor: '#5b7fff', backgroundColor: '#5b7fff88', fill: false, tension: 0.2 }
                ]
            },
            options: {
                plugins: { legend: { position: 'top' } },
                scales: { y: { min: 0, max: 10, title: { display: true, text: 'Dolor (0-10)' } } }
            }
        });
    }

    // --- Comparativa de mejora entre pacientes ---
    function mostrarComparativa() {
        let pacientes = Object.keys(pacientesDatos);
        let dolorInicio = pacientes.map(p => pacientesDatos[p].dolorMax[0]);
        let dolorFin = pacientes.map(p => pacientesDatos[p].dolorMax[6]);
        let grupo = pacientes.map(p => pacientesDatos[p].info.grupo);
        let ctx = document.getElementById('graficoComparativa').getContext('2d');
        if (window.graficoComparativaObj) window.graficoComparativaObj.destroy();
        window.graficoComparativaObj = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: pacientes,
                datasets: [
                    { label: 'Dolor máximo Día 1', data: dolorInicio, backgroundColor: grupo.map(g=>g=="Música"?"#4fd1c5":"#5b7fff") },
                    { label: 'Dolor máximo Día 31', data: dolorFin, backgroundColor: grupo.map(g=>g=="Música"?"#4fd1c588":"#5b7fff88") }
                ]
            },
            options: {
                plugins: { legend: { position: 'top' } },
                scales: { y: { min: 0, max: 10, title: { display: true, text: 'Dolor máximo (0-10)' } } }
            }
        });
    }
    mostrarComparativa();
    </script>
</body>
</html>
